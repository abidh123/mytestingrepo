trigger:
  - None
pool:
  vmImage: 'windows-latest'  
stages:
  - stage: build_project_archive_publish
    jobs:
      - job: 
        steps:
          - task: DotNetCoreCLI@2
            displayName: 'Build project'
            inputs:
              projects: '**/*.csproj'
              arguments: '--output publish_output --configuration Release'
          - task: ArchiveFiles@2
            displayName: 'Archive files'
            inputs:
              rootFolderOrFile: 'publish_output/'
              includeRootFolder: false
          - task: PublishBuildArtifacts@1
            displayName: 'Publish Artifact: drop'   
  
  - stage: Deploy
    displayName: Deploy Stage
    dependsOn: build_project_archive_publish
    condition: succeeded()
    jobs:
      - deployment: Deploy
        displayName: Deploy
        environment: 'development'
        pool:
          vmImage: 'windows-latest'
        strategy:
         runOnce:
           deploy:
             steps:
               - task: AzureFunctionApp@2
                 displayName: 'Azure function app deploy'
                 inputs:
                   connectedServiceNameARM: 'AzureFunc'
                   appType: 'functionApp'
                   appName: 'TestFunctionApp'
                   package: '$(System.DefaultWorkingDirectory)/**/*.zip'
                   deploymentMethod: 'zipDeploy'

